<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Корзина</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body style="background-color:white; font-family: tech;">
  <div class="header">
    <a href="web.experiment_catalog.html" class="home">
      <img class="logo" src="assets/logoforhead2.png" alt="" width="320" height="96">
    </a>
  </div>

  <div style="margin-top: 160px; padding: 40px;">
    <h1>Твоя корзина</h1>
    <div id="cart-container" style="font-size: 20px;"></div>
  </div>

  <script>
    fetch('/cart.json')
      .then(response => {
        if (!response.ok) throw new Error('Ошибка чтения корзины');
        return response.json();
      })
      .then(cart => {
        const container = document.getElementById('cart-container');
        if (cart.length === 0) {
          container.innerHTML = '<p>Корзина пуста.</p>';
          return;
        }

        let total = 0;
        cart.forEach((item, index) => {
          total += item.price;

          const block = document.createElement('div');
          block.style.marginBottom = '20px';
          block.innerHTML = `
            <strong>${item.name}</strong> — Размер: ${item.size} — ${item.price}₽
            <button onclick="removeItem(${index})">Удалить</button>
          `;
          container.appendChild(block);
        });

        const totalBlock = document.createElement('div');
        totalBlock.style.marginTop = '40px';
        totalBlock.innerHTML = `<h2>Итого: ${total}₽</h2>`;
        container.appendChild(totalBlock);
      })
      .catch(err => {
        document.getElementById('cart-container').innerText = 'Ошибка загрузки корзины';
        console.error(err);
      });

    function removeItem(index) {
      fetch('/api/remove-from-cart', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ index })
      }).then(() => location.reload());
    }
  </script>
</body>
</html>
