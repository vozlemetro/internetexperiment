<!DOCTYPE html>
<html>
<head>

  <title>web.experiment</title>
  <meta charset ="utf-8">  
  <link rel="stylesheet" href="styles.css">
  <link rel="shortcut icon" href="/assets/logo.png"/>

</head>

<body>

    <div class = 'cartbody'>
  
      <div class='header'>
  
        <a href="index.html" class = home>
          <img class = 'logo' src="assets\logoforhead2.png" alt="" width="320" height="96">
        </a>
  
        <a href="cart.html" class = shopbutton>
          <img class = 'bin' src="assets\P example.png" alt="" width="64" height="64">
        </a>
  
        <a href="profile.html" class = profilebutton>
          <img class = 'profile' src="assets\profile.png" alt="" width="64" height="64">
        </a>
  
      </div>
  
      <div class="backimage">

        <img src="assets/bin.jpg" alt="" width="1000" height="720">

        <div class = "binitem">
          <img src="assets/ite.jpg" alt="" width="159" height="159" style="margin-top: 1px;">

          <div class="bintext">
            
            <div class = "binh1">dragonborn jacket</div>

            <div class = "binh2">15000 rub.</div>
          
          </div>

          <div class="binsize">SIZE: M</div>

          <button class="cancelbutton"> </button>

        </div>

        <div class = "binitem">
          <img src="assets/ite.jpg" alt="" width="159" height="159" style="margin-top: 1px;">

          <div class="bintext">
            
            <div class = "binh1">dragonborn jacket</div>

            <div class = "binh2">15000 rub.</div>
          
          </div>

          <div class="binsize">SIZE: M</div>

          <button class="cancelbutton"> </button>

        </div>

        <div class = "binitem">
          <img src="assets/ite.jpg" alt="" width="159" height="159" style="margin-top: 1px;">

          <div class="bintext">
            
            <div class = "binh1">dragonborn jacket</div>

            <div class = "binh2">15000 rub.</div>
          
          </div>

          <div class="binsize">SIZE: M</div>

          <button class="cancelbutton"> </button>

        </div>

        <button class = "nextitem"> NEXT ITEM </button>

      </div>

      <button class = "buttonOrder" onclick = "location.href='order.html'"> ORDER </button>

    </div>

  <script>
    fetch('/cart.json')
      .then(response => {
        if (!response.ok) throw new Error('Ошибка чтения корзины');
        return response.json();
      })
      .then(cart => {
        const container = document.getElementById('cart-container');
        if (cart.length === 0) {
          container.innerHTML = '<p>Корзина пуста.</p>';
          return;
        }

        let total = 0;
        cart.forEach((item, index) => {
          total += item.price;

          const block = document.createElement('div');
          block.style.marginBottom = '20px';
          block.innerHTML = `
            <strong>${item.name}</strong> — Размер: ${item.size} — ${item.price}₽
            <button onclick="removeItem(${index})">Удалить</button>
          `;
          container.appendChild(block);
        });

        const totalBlock = document.createElement('div');
        totalBlock.style.marginTop = '40px';
        totalBlock.innerHTML = `<h2>Итого: ${total}₽</h2>`;
        container.appendChild(totalBlock);
      })
      .catch(err => {
        document.getElementById('cart-container').innerText = 'Ошибка загрузки корзины';
        console.error(err);
      });

    function removeItem(index) {
      fetch('/api/remove-from-cart', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ index })
      }).then(() => location.reload());
    }
  </script>
</body>
</html>
